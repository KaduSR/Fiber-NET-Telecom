// backend/src/proactive.ts
import { EventEmitter } from 'events';
import { monitorNetwork, checkBillingDueDates, getScheduledMaintenances } from './integrations';

export class ProactiveMonitor extends EventEmitter {
  start() {
    // Monitorar problemas de rede
    setInterval(async () => {
      const issues = await monitorNetwork();
      for (const issue of issues) {
        this.emit(`alert:${issue.customerId}`, {
          id: crypto.randomUUID(),
          type: 'network_issue',
          priority: 'high',
          message: `Detectamos instabilidade na sua região. Nossos técnicos já estão trabalhando nisso. Previsão de normalização: ${issue.eta}`,
          actions: [
            { type: 'open_ticket', label: 'Abrir Chamado' },
            { type: 'view_status', label: 'Ver Status' },
          ],
        });
      }
    }, 60000); // A cada minuto

    // Lembrete de vencimento de fatura
    setInterval(async () => {
      const dueBills = await checkBillingDueDates();
      for (const bill of dueBills) {
        this.emit(`alert:${bill.customerId}`, {
          id: crypto.randomUUID(),
          type: 'bill_reminder',
          priority: 'medium',
          message: `Sua fatura de R$ ${bill.amount} vence em ${bill.daysUntilDue} dias.`,
          actions: [
            { type: 'view_bill', label: 'Ver Fatura' },
            { type: 'pay_now', label: 'Pagar Agora' },
          ],
        });
      }
    }, 3600000); // A cada hora
  }
}

07.md